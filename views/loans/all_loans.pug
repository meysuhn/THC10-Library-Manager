extends ../layout

block content
    h1 Loans
    include ../includes/loans_nav.pug
    table
      thead
        tr
          th Book
          th Patron
          th Loaned on
          th Return by
          th Status
          th Return Book
          th Delete Entry
      tbody
          each loan in loans
              tr
                td
                  a(href=`/books/${loan.Book.id}`)=loan.Book.title
                td
                  a(href=`/patrons/${loan.Patron.id}`)=loan.Patron.first_name  + ' ' + loan.Patron.last_name
                td=loan.loaned_on
                td=loan.return_by
                td
                  if loan.returned_on
                    =`Returned` + ` ` + `(` + loan.returned_on + `)`
                  else
                    p With Patron
                      if loan.return_by < todaysDate
                        p Overdue     
                        //- NOTE this needs to be tidied up     
                td
                  if loan.returned_on
                    p Returned
                  else
                    a.button(href=`/loans/${loan.id}/return`) Return
                td
                  a.button(class='delete' href=`/loans/${loan.id}/delete`) Delete
                  
                  //- h2 Loan History
                  //- if loanHistory.length > 0
                  //-     include ../includes/loan_history.pug
                  //- else 
                  //-   p There is no Loan History for #{patronDetail.first_name} #{patronDetail.last_name}


  
